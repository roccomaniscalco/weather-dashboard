<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Weather</title>
    <!-- bootstrap css CDN -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z"
      crossorigin="anonymous"
    />
  </head>

  <body>
    <!-- head bar -->
    <nav class="navbar sticky-top navbar-dark bg-dark">
      <span class="navbar-brand mb-0 h1">Weather Dashboard</span>
    </nav>
    <div class="container" style="max-width: 100%; max-height: 100%">
      <div class="row">
        <!-- side bar -->
        <div
          class="col-md-4"
          style="background-color: gainsboro; padding: 10px"
        >
          <!-- search box -->
          <form class="d-flex" style="padding-bottom: 10px" id="search">
            <input
              type="text"
              placeholder="Add city..."
              class="form-control"
              id="search-input"
            />
            <button
              type="submit"
              class="btn btn-primary"
              style="width: 40px; height: 38px; padding: 1px"
            >
              <img src="./search.png" style="width: 80%" />
            </button>
          </form>
          <!-- menu -->
          <div class="card">
            <ul class="list-group list-group-flush" id="menu"></ul>
          </div>
        </div>
        <!-- weather content -->
        <main class="col-md-8" style="padding: 10px">
          <!-- Current report -->
          <section
            class="card"
            style="margin-top: 10px; padding: 10px"
            id="report"
          ></section>
          <!-- 5 day forecast -->
          <section
            class="container"
            style="margin-top: 10px; padding: 10px"
            data-tag="forecast"
          >
            <div class="row" id="forecast"></div>
          </section>
        </main>
      </div>
    </div>

    <!-- Jquery CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <!-- Logic -->
    <script>
      // Upon page loading...
      $(document).ready(function () {
        //localStorage.clear();

        var userCity = "São Paulo";
        var cities = [];
        if (localStorage.getItem("savedCities") != null)
          cities = JSON.parse(localStorage.getItem("savedCities"));
        if (localStorage.getItem("savedCity") != null)
          userCity = localStorage.getItem("savedCity");

        displayCities();
        displayWeather(userCity);

        // Display cities[] in side bar menu
        function displayCities() {
          $("#menu").html("");
          for (var i = 0; i < cities.length; i++)
            $("ul").prepend(
              $("<li class='list-group-item'>" + cities[i] + "</li>")
            );
        }

        // Display current weather
        function displayWeather(city) {
          localStorage.setItem("savedCity", city);
          $("#report").html("");
          // Call API with passed-in city
          $.ajax({
            url:
              "https://api.openweathermap.org/data/2.5/weather?q=" +
              city +
              "&units=imperial&appid=363cbd4e4beb8ea88e1a4d08a04b028b",
            method: "GET",
          }).then(function (response) {
            $("#report").append($("<h1>" + response.name + " </h1>"));
            $("#report").append(
              $("<h2>" + Math.round(response.main.temp) + "° </h2>")
            );
            $("#report").append(
              $("<span>Humidity: " + response.main.humidity + "% </span>")
            );
            $("#report").append(
              $(
                "<span>Wind Speed: " +
                  Math.round(response.wind.speed) +
                  " MPH</span>"
              )
            );
            // Call API with passed-in city's coordinates
            $.ajax({
              url:
                "http://api.openweathermap.org/data/2.5/uvi?lat=" +
                response.coord.lat +
                "&lon=" +
                response.coord.lon +
                "&appid=363cbd4e4beb8ea88e1a4d08a04b028b",
              method: "GET",
            }).then(function (responseUV) {
              $("#report").append(
                $("<span>UV index: " + Math.round(responseUV.value) + "</span>")
              );
            });
          });
        }

        // Upon clicking search button...
        $("#search").on("submit", function (event) {
          event.preventDefault();
          userCity = $("#search-input").val();

          // Call API with searched city
          $.ajax({
            url:
              "https://api.openweathermap.org/data/2.5/weather?q=" +
              userCity +
              "&appid=363cbd4e4beb8ea88e1a4d08a04b028b",
            method: "GET",
          }).then(function (response) {
            if (!cities.includes(response.name)) {
              cities.push(response.name);
              displayCities();
              localStorage.setItem("savedCities", JSON.stringify(cities));
            }
            displayWeather(userCity);
          });
          $("#search-input").val("");
        });

        // Upon clicking a menu item...
        $("#menu").on("click", "li", function () {
          displayWeather($(this).text());
        });
      });
    </script>
  </body>
</html>
